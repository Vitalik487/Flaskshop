{% import 'dashboard/_macros.html' as macros %}
{% extends 'dashboard/layout.html' %}
{% block body %}
    <section class="content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="card card-primary card-outline">
                        <div class="card-header">
                            <h3 class="card-title">
                                <a href="{{ url_for('product.show', id=product.id) }}"
                                   target="_blank">{{ product.title }}</a>
                            </h3>
                            <div class="card-tools" style="display: flex;">
                                <div class="input-group input-group-sm">
                                    <a href="{{ url_for('dashboard.product_edit', id=product.id) }}"
                                       class="btn btn-primary btn-sm" style="margin-right: 5px;">{% trans %}
                                        Edit{% endtrans %}</a>
                                    <a data-url="products/{{ product.id }}/delete" data-redirect="1"
                                       class="btn btn-danger btn-sm delete-btn">{% trans %}Delete{% endtrans %}</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div v-scope @vue:mounted="autoPlay()">
                                        <div class="container" @mouseenter="stopPlay()">
                                            <div id="imgBox" class="img-box" :style="{left: left + 'px'}">
                                                {% for img in product.images %}
                                                    <img src="{{ img }}" class="loop-image">
                                                {% endfor %}
                                            </div>
                                            <a class="prev" @click="prev"><</a>
                                            <a class="next" @click="next">></a>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-group mb-3">
                                        <li class="list-group-item">
                                            <b>{% trans %}On Sale{% endtrans %}</b> <span
                                                class="float-right">{{ macros.render_boolean(product.on_sale) }}</span>
                                        </li>
                                        <li class="list-group-item">
                                            <b>{% trans %}Price{% endtrans %}</b> <span
                                                class="float-right">${{ product.price }} /
                                            ${{ product.basic_price }}</span>
                                        </li>
                                        <li class="list-group-item">
                                            <b>{% trans %}Rating{% endtrans %}</b> <span
                                                class="float-right">{{ product.rating }}</span>
                                        </li>
                                        <li class="list-group-item">
                                            <b>{% trans %}Sold Count{% endtrans %}</b> <span
                                                class="float-right">{{ product.sold_count }}</span>
                                        </li>
                                        <li class="list-group-item">
                                            <b>{% trans %}Review Count{% endtrans %}</b> <span
                                                class="float-right">{{ product.review_count }}</span>
                                        </li>
                                        <li class="list-group-item">
                                            <b>{% trans %}Category{% endtrans %}</b> <span
                                                class="float-right">{{ product.category }}</span>
                                        </li>
                                        <li class="list-group-item">
                                            <b>{% trans %}ProductType{% endtrans %}</b> <span
                                                class="float-right">{{ product.product_type }}</span>
                                        </li>
                                        <li class="list-group-item">
                                            <b>{% trans %}Created{% endtrans %}</b> <span
                                                class="float-right">{{ product.created_at }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="row">
                                <p class="lead">{% trans %}Product Description{% endtrans %}:</p>
                                <p class="text-muted well well-sm no-shadow">
                                    {{ product.description }}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div><!-- /.row -->

            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="m-0">{% trans %}Variants{% endtrans %}</h5>
                            <div class="card-tools" style="display: flex;">
                                <div class="input-group input-group-sm">
                                    <a href="{{ url_for('dashboard.variant_manage', product_id=product.id) }}"
                                       class="btn btn-success btn-sm">{% trans %}Create{% endtrans %}</a>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <table class="table table-hover">
                                <tr>
                                    <th>{% trans %}ID{% endtrans %}</th>
                                    <th>{% trans %}SKU{% endtrans %}</th>
                                    <th>{% trans %}Title{% endtrans %}</th>
                                    <th>{% trans %}Quantity{% endtrans %}</th>
                                    <th>{% trans %}PriceOverride{% endtrans %}</th>
                                    <th>{% trans %}Operation{% endtrans %}</th>
                                </tr>
                                {% for item in product.variant %}
                                    <tr>
                                        <td>{{ item.id }}</td>
                                        <td>{{ item.sku }}</td>
                                        <td>{{ item.title }}</td>
                                        <td>{{ item.quantity }}</td>
                                        <td>{{ item.price_override }}</td>
                                        <td>
                                            <a href="{{ url_for('dashboard.variant_manage', id=item.id) }}"
                                               class="btn btn-primary btn-sm">{% trans %}Edit{% endtrans %}</a>
                                            <a data-url="variants/{{ item.id }}/delete"
                                               class="btn btn-danger btn-sm delete-btn">{% trans %}
                                                Delete{% endtrans %}</a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div><!-- /.container-fluid -->


    </section>

{% endblock %}

{% block tail_js %}
    {#<script src="{{ url_for('static', filename='build/dashboard/product_detail.js') }}"></script>#}

    <script type="module">
        import {createApp} from 'https://unpkg.com/petite-vue?module'

        const imgBoxEl = document.getElementById("imgBox")
        imgBoxEl.style.width = imgBoxEl.children.length * 400 + 'px'
        createApp({
            index: 0,
            left: 0,
            timer: null,
            count: imgBoxEl.children.length,
            $delimiters: ['[[', ']]'],
            prev() {
                this.index--;
                if (this.index < 0) {
                    this.index = this.count - 1;
                    this.left = -400 * this.count;
                }
                this.left += 400;
            },
            next() {
                this.index++;
                if (this.index > this.count - 1) {
                    this.index = 0;
                    this.left = 0;
                } else {
                    this.left -= 400;
                }

            },
            autoPlay() {
                this.timer = setInterval(() => {
                    this.next();
                }, 3000);
            },
            stopPlay() {
                // 停止播放
                clearInterval(this.timer);
            }
        }).mount()
    </script>
    <style>
        .container {
            width: 400px; /* 容器宽度 */
            height: 400px; /* 容器高度 */
            overflow: hidden; /* 隐藏溢出部分 */
            position: relative; /* 相对定位 */
        }

        .img-box {
            height: 400px; /* 图片容器高度 */
            position: relative; /* 相对定位 */
            z-index: 0;
        }

        .img-box img {
            width: 400px; /* 图片宽度 */
            height: 400px; /* 图片高度 */
            float: left; /* 左浮动 */
        }

        .prev, .next {
            position: absolute;
            height: 400px;
            width: 30px;
            font: 30px/300px '微软雅黑';
            text-align: center;
            color: #8B7B8B;
            opacity: 0.2;
            z-index: 50;

        }

        .prev:hover, .next:hover {
            background: #cdc1c5;
            color: #f8f8ff;
            opacity: 0.5;
            cursor: pointer;
        }

        .prev {
            left: 0;
            top: 0;
        }

        .next {
            right: 0;
            top: 0;
        }


    </style>
{% endblock %}
